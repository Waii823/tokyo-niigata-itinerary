<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>2026 æ—¥æœ¬æ±äº¬ Ã— è¶Šå¾Œæ¹¯æ¾¤ Ã— æ–°æ½Ÿ 9 å¤©èˆ‡é™¸å°‘XDåŒè¡Œè¡Œç¨‹</title>

  <!-- Google Fontsï¼šä¸­è‹±å„ªé›…å­—é«”ï¼ˆåŠ ä¸Š data-versioned ç”¨ä¾†è‡ªå‹•å¸¶ç‰ˆæœ¬è™Ÿï¼‰ -->
  <link data-versioned="true" href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Playfair+Display:wght@500;700&display=swap" rel="stylesheet">

  <!-- Leaflet Mapï¼ˆåŒæ¨£åŠ ä¸Š data-versionedï¼‰ -->
  <link
    rel="stylesheet"
    data-versioned="true"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />

  <style>
    :root {
      --bg-ivory: #f7f3ec;
      --bg-panel: #ffffff;
      --blue-fog: #d4dde9;
      --blue-deep: #3a526e;
      --gold-warm: #c9a36b;
      --gold-soft: #e1c79a;
      --text-main: #2f3640;
      --text-muted: #7b8088;
      --border-soft: rgba(58, 82, 110, 0.08);
      --shadow-soft: 0 14px 35px rgba(20, 33, 61, 0.12);
      --radius-xl: 24px;
      --radius-lg: 18px;
      --transition-fast: 0.18s ease-out;
      --transition-med: 0.28s ease;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Noto Sans TC", system-ui, -apple-system, BlinkMacSystemFont,
        "Segoe UI", sans-serif;
      background: radial-gradient(circle at top left, #e6edf7 0, #f7f3ec 45%, #f8f4ef 100%);
      color: var(--text-main);
      line-height: 1.6;
      padding: 24px;
      -webkit-font-smoothing: antialiased;
    }

    .page {
      max-width: 1280px;
      margin: 0 auto;
      background: linear-gradient(145deg, rgba(255,255,255,0.98), rgba(244,247,252,0.96));
      border-radius: 32px;
      box-shadow: 0 28px 80px rgba(20, 33, 61, 0.18);
      padding: 28px 32px 32px;
      position: relative;
      overflow: hidden;
    }

    /* èƒŒæ™¯è£é£¾åœ“åœˆ */
    .page::before,
    .page::after {
      content: "";
      position: absolute;
      border-radius: 999px;
      filter: blur(40px);
      opacity: 0.55;
      pointer-events: none;
    }

    .page::before {
      width: 260px;
      height: 260px;
      background: radial-gradient(circle, rgba(212,221,233,0.9), transparent 70%);
      top: -60px;
      right: -40px;
    }

    .page::after {
      width: 240px;
      height: 240px;
      background: radial-gradient(circle, rgba(201,163,107,0.6), transparent 70%);
      bottom: -80px;
      left: -40px;
    }

    header {
      display: flex;
      justify-content: space-between;
      gap: 18px;
      margin-bottom: 24px;
      position: relative;
      z-index: 1;
    }

    .title-block {
      flex: 2;
    }

    h1 {
      font-family: "Playfair Display", "Noto Sans TC", serif;
      font-size: 28px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--blue-deep);
      margin-bottom: 6px;
    }

    .subtitle {
      font-size: 15px;
      color: var(--text-muted);
      margin-bottom: 10px;
    }

    .meta {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      font-size: 13px;
      color: var(--text-muted);
    }

    .meta-pill {
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(58, 82, 110, 0.06);
      border: 1px solid rgba(58, 82, 110, 0.08);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .meta-pill span.icon {
      width: 16px;
      height: 16px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, #fefefe, var(--blue-deep));
      display: inline-block;
    }

    .budget-summary {
      flex: 1.2;
      background: linear-gradient(150deg, rgba(58,82,110,0.95), #1f2b3c);
      border-radius: 24px;
      padding: 14px 16px 16px;
      color: #fdfdfd;
      box-shadow: 0 18px 45px rgba(10,20,40,0.65);
      position: relative;
      overflow: hidden;
    }

    .budget-summary::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top right, rgba(255,255,255,0.18), transparent 55%);
      opacity: 0.9;
      pointer-events: none;
    }

    .budget-summary h2 {
      font-size: 15px;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      margin-bottom: 6px;
      opacity: 0.95;
    }

    .budget-row {
      display: flex;
      justify-content: space-between;
      font-size: 13px;
      margin-bottom: 4px;
      opacity: 0.9;
    }

    .budget-em {
      font-size: 21px;
      font-weight: 600;
      color: #ffe9bf;
      letter-spacing: 0.02em;
    }

    .budget-note {
      margin-top: 8px;
      font-size: 11px;
      opacity: 0.8;
    }

    main {
      display: grid;
      grid-template-columns: minmax(0, 1.5fr) minmax(0, 1.1fr);
      gap: 16px;
      position: relative;
      z-index: 1;
    }

    /* è¡Œç¨‹èˆ‡åœ°åœ–å®¹å™¨ */
    .panel {
      border-radius: var(--radius-xl);
      background: rgba(255,255,255,0.9);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.9);
      box-shadow: 0 18px 40px rgba(8, 16, 32, 0.08);
      padding: 14px 14px 16px;
      position: relative;
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      padding-bottom: 6px;
      border-bottom: 1px solid var(--border-soft);
    }

    .panel-title {
      font-size: 15px;
      font-weight: 600;
      color: var(--blue-deep);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .panel-title-dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, #fffef8, var(--gold-warm));
    }

    .panel-subtitle {
      font-size: 12px;
      color: var(--text-muted);
    }

    /* è¡Œç¨‹åˆ—è¡¨ */
    .itinerary-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .day-card {
      background: linear-gradient(135deg, #ffffff, #f5f6fb);
      border-radius: var(--radius-lg);
      padding: 10px 12px;
      border: 1px solid rgba(201,163,107,0.25);
      box-shadow: 0 10px 28px rgba(33, 42, 63, 0.08);
      cursor: grab;
      position: relative;
      transition: transform var(--transition-fast),
        box-shadow var(--transition-fast), border-color var(--transition-fast),
        background var(--transition-fast);
    }

    .day-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 14px 32px rgba(24, 36, 64, 0.16);
      border-color: rgba(201,163,107,0.65);
    }

    .day-card.dragging {
      opacity: 0.7;
      cursor: grabbing;
      transform: scale(0.99);
      box-shadow: 0 16px 40px rgba(10,16,30,0.32);
    }

    .day-card.drag-over {
      outline: 1px dashed rgba(58,82,110,0.55);
      outline-offset: -4px;
    }

    .day-header {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 4px;
      align-items: baseline;
    }

    .day-label {
      font-size: 12px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--gold-warm);
      font-weight: 600;
    }

    .day-main-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--blue-deep);
    }

    .day-region-pill {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(58,82,110,0.06);
      color: var(--text-muted);
      border: 1px solid rgba(58,82,110,0.12);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .day-body {
      font-size: 12px;
      color: var(--text-main);
    }

    .day-body ul {
      margin-left: 16px;
      margin-top: 4px;
    }

    .day-body li {
      margin-bottom: 2px;
    }

    .day-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    .day-tag {
      font-size: 11px;
      padding: 2px 7px;
      border-radius: 999px;
      background: rgba(201,163,107,0.08);
      color: #694b23;
    }

    .day-budget {
      margin-top: 4px;
      font-size: 11px;
      color: var(--text-muted);
    }

    /* åœ°åœ–èˆ‡é¤å»³å€ */
    #map {
      width: 100%;
      height: 260px;
      border-radius: 18px;
      overflow: hidden;
      border: 1px solid rgba(58,82,110,0.15);
      box-shadow: 0 14px 35px rgba(10, 25, 50, 0.18);
    }

    .map-legend {
      margin-top: 8px;
      display: flex;
      justify-content: space-between;
      gap: 8px;
      align-items: center;
      font-size: 11px;
      color: var(--text-muted);
    }

    .map-legend span.dot-tokyo,
    .map-legend span.dot-niigata {
      width: 9px;
      height: 9px;
      border-radius: 999px;
      display: inline-block;
      margin-right: 4px;
    }
    .map-legend span.dot-tokyo {
      background: #f28f6b;
    }
    .map-legend span.dot-niigata {
      background: #5b8ad6;
    }

    .restaurant-panel {
      margin-top: 10px;
      padding-top: 6px;
      border-top: 1px dashed var(--border-soft);
    }

    .restaurant-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 6px;
    }

    .restaurant-item {
      display: flex;
      justify-content: space-between;
      gap: 6px;
      align-items: center;
      font-size: 12px;
    }

    .restaurant-info {
      flex: 1;
    }

    .restaurant-name {
      font-weight: 600;
      color: var(--blue-deep);
    }

    .restaurant-tags {
      font-size: 11px;
      color: var(--text-muted);
    }

    .restaurant-action a {
      font-size: 11px;
      text-decoration: none;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(201,163,107,0.8);
      color: #6a4a21;
      background: linear-gradient(135deg, #fffaf2, #f0e0c6);
      box-shadow: 0 5px 12px rgba(120, 80, 30, 0.18);
      transition: transform var(--transition-fast), box-shadow var(--transition-fast),
        background var(--transition-fast);
      white-space: nowrap;
    }

    .restaurant-action a:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 20px rgba(120, 80, 30, 0.28);
      background: linear-gradient(135deg, #fff4dd, #ead0aa);
    }

    .open-status {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 2px;
    }

    /* è¡Œç¨‹å·¥å…·åˆ— */
    .toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      gap: 8px;
      font-size: 12px;
      color: var(--text-muted);
    }

    .toolbar button {
      border-radius: 999px;
      border: 1px solid rgba(58,82,110,0.12);
      background: rgba(58,82,110,0.04);
      padding: 4px 10px;
      font-size: 11px;
      color: var(--blue-deep);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: background var(--transition-fast), box-shadow var(--transition-fast),
        transform var(--transition-fast), border-color var(--transition-fast);
    }

    .toolbar button:hover {
      background: rgba(58,82,110,0.09);
      border-color: rgba(58,82,110,0.22);
      box-shadow: 0 6px 18px rgba(25, 40, 68, 0.16);
      transform: translateY(-1px);
    }

    .toolbar button span.icon {
      width: 14px;
      height: 14px;
      border-radius: 999px;
      border: 1px solid rgba(201,163,107,0.68);
      background: radial-gradient(circle at 30% 20%, #fffefa, #e0c293);
    }

    @media (max-width: 960px) {
      body {
        padding: 12px;
      }
      .page {
        padding: 18px 16px 20px;
        border-radius: 20px;
      }
      header {
        flex-direction: column;
      }
      main {
        grid-template-columns: 1fr;
      }
      #map {
        height: 260px;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <div class="title-block">
        <h1>Tokyo Ã— è¶Šå¾Œæ¹¯æ¾¤ Ã— æ–°æ½Ÿï½œ9å¤©å†¬å­£è¡Œç¨‹</h1>
        <div class="subtitle">
          2026/1/10 å¤œæ™šæŠµé”æ±äº¬ Â· 2026/1/18 16:55 è‡ªæ±äº¬è¿”ç¨‹<br />
          1å¤©æ±äº¬éå¤œ Â· 8å¤©è¶Šå¾Œæ¹¯æ¾¤ & æ–°æ½Ÿé›ªåœ‹ï¼ˆå«ç§»å‹•æ—¥ï¼‰ Â· å«2å¤©æ»‘é›ª & æº«æ³‰
        </div>
        <div class="meta">
          <div class="meta-pill">
            <span class="icon"></span> å…± 9 å¤© Â· 8 æ™š
          </div>
          <div class="meta-pill">
            â›·ï¸ 2 å¤©æ»‘é›ªï¼ˆGALA æ¹¯æ¾¤ & Kaguraï¼‰
          </div>
          <div class="meta-pill">
            ğŸš„ æ±äº¬ &lt;&gt; è¶Šå¾Œæ¹¯æ¾¤ & æ–°æ½Ÿï¼šä¸Šè¶Šæ–°å¹¹ç·š
          </div>
          <div class="meta-pill">
            ğŸ¶ æ–°æ½Ÿç±³é£¯ Â· æ¸…é…’ Â· æ—¥æœ¬æµ·æµ·é®®
          </div>
        </div>
      </div>
      <div class="budget-summary">
        <h2>é ç®—ç¸½è¦½ Â· JPY</h2>
        <div class="budget-row">
          <span>ä¼°è¨ˆç¸½é ç®—ï¼ˆæ¯äººï¼‰</span>
          <span id="totalRange" class="budget-em">â€“</span>
        </div>
        <div class="budget-row">
          <span>æ¯æ—¥å¹³å‡</span>
          <span id="dailyRange">â€“</span>
        </div>
        <div class="budget-row">
          <span>ä¸»è¦èŠ±è²»</span>
          <span>äº¤é€š Â· æ»‘é›ªå¥—ç¥¨ Â· é¤é£² Â· é–€ç¥¨</span>
        </div>
        <div class="budget-note">
          â€» ä»¥ä¸Šè¶Šæ–°å¹¹ç·šç¥¨åƒ¹å€é–“ã€æ»‘é›ªä¸€æ—¥åˆ¸ï¼‹ç§Ÿè£å‚™ã€æ–°æ½Ÿå¹³å‡é¤è²»æ¨ä¼°ã€‚<br />
          â€» ä¸å«åœ‹éš›æ©Ÿç¥¨èˆ‡è³¼ç‰©æ”¯å‡ºï¼Œå¯¦éš›è²»ç”¨è¦–åŒ¯ç‡èˆ‡é ç´„æ–¹æ¡ˆèª¿æ•´ã€‚
        </div>
      </div>
    </header>

    <main>
      <!-- å·¦å´ï¼šè¡Œç¨‹ -->
      <section class="panel">
        <div class="panel-header">
          <div>
            <div class="panel-title">
              <span class="panel-title-dot"></span> äº’å‹•è¡Œç¨‹è¡¨ï¼ˆå¯æ‹–æ‹½æ’åºï¼‰
            </div>
            <div class="panel-subtitle">
              æ‹–æ›³æ¯ä¸€å¤©å³å¯é‡æ–°æ’ç¨‹ï¼Œå³å´åœ°åœ–å‹•ç·šèˆ‡é ç®—å°‡åŒæ­¥æ›´æ–°ã€‚
            </div>
          </div>
          <div class="toolbar">
            <span>æç¤ºï¼šæ‰‹æ©Ÿé•·æŒ‰æ—¥å¡æ‹–æ›³ Â· æ¡Œæ©ŸæŒ‰ä½æ‹–å‹•</span>
            <button id="resetOrderBtn">
              <span class="icon"></span> å›åˆ°å»ºè­°æ’åº
            </button>
          </div>
        </div>
        <div id="itineraryList" class="itinerary-list"></div>
      </section>

      <!-- å³å´ï¼šåœ°åœ– & é¤å»³ -->
      <section class="panel">
        <div class="panel-header">
          <div>
            <div class="panel-title">
              <span class="panel-title-dot"></span> åœ°åœ– & å‹•ç·šæœ€ä½³åŒ–
            </div>
            <div class="panel-subtitle">
              é»é¸è¡Œç¨‹æ—¥å¯åœ¨åœ°åœ–ä¸Šé«˜äº®ç•¶å¤©é‡é»åœ°é»ã€‚
            </div>
          </div>
        </div>
        <div id="map"></div>
        <div class="map-legend">
          <div>
            <span class="dot-tokyo"></span> æ±äº¬å€åŸŸ
            &nbsp;&nbsp;
            <span class="dot-niigata"></span> è¶Šå¾Œæ¹¯æ¾¤ Â· æ–°æ½Ÿå€åŸŸ
          </div>
          <div>ç·šæ¢ï¼šä¾ç›®å‰è¡Œç¨‹æ’åºä¸²é€£çš„ç§»å‹•å‹•ç·šï¼ˆæ–°å¹¹ç·šï¼æ»‘é›ªï¼å¸‚å€ï¼‰</div>
        </div>

        <div class="restaurant-panel">
          <div class="panel-title" style="font-size: 13px; margin-bottom: 2px;">
            <span class="panel-title-dot"></span> æ¨è–¦é¤å»³ Â· è¨‚ä½ & å³æ™‚ç‡Ÿæ¥­æ™‚é–“
          </div>
          <div class="panel-subtitle" style="font-size: 11px;">
            é»æ“Šã€ŒæŸ¥çœ‹åœ°åœ– / è¨‚ä½ã€å°‡é–‹å•Ÿ Google åœ°åœ–ï¼šå¯ç›´æ¥æŸ¥çœ‹ç‡Ÿæ¥­æ™‚é–“ã€é›»è©±èˆ‡ç·šä¸Šè¨‚ä½é€£çµã€‚
          </div>
          <div id="restaurantList" class="restaurant-list"></div>
        </div>
      </section>
    </main>
  </div>

  <!-- Leaflet Scriptï¼ˆåŠ ä¸Š data-versioned ç”¨ cache-bustingï¼‰ -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
    data-versioned="true"
  ></script>

  <script>
    // === æ ¸å¿ƒè¡Œç¨‹è³‡æ–™ï¼ˆ1å¤©æ±äº¬ + 8å¤©æ–°æ½Ÿç¸£ï¼Œå«2å¤©æ»‘é›ªï¼‰ ===
    const initialItinerary = [
      {
        id: 1,
        date: "2026-01-10",
        label: "Day 1 Â· 1/10ï¼ˆå…­ï¼‰",
        region: "æ±äº¬",
        title: "å¤œæ™šæŠµé”æ±äº¬ Â· æ–°å®¿æ•£æ­¥",
        description:
          "å‚æ™šæˆ–å¤œæ™šæŠµé”æ±äº¬ï¼Œæ­é›»è»Šå‰å¾€æ–°å®¿å‘¨é‚Šé£¯åº—è¾¦ç†å…¥ä½ï¼Œç°¡å–®ç†Ÿæ‚‰ç’°å¢ƒã€‚æ™šä¸Šå¯å‰å¾€æ–°å®¿å—å£ï¼NEWoMan æˆ–éƒ½å»³å¤œæ™¯ï¼Œé©æ‡‰æ°£å€™èˆ‡æ™‚å·®ã€‚",
        bullets: [
          "æˆç”°ï¼ç¾½ç”°æ©Ÿå ´ â‡’ æ±äº¬ï¼æ–°å®¿ï¼ˆN'EX æˆ–æ©Ÿå ´å·´å£«ï¼‰",
          "å…¥ä½æ–°å®¿è»Šç«™å‘¨é‚Šé£¯åº—ï¼Œæ–¹ä¾¿éš”æ—¥ç§»å‹•",
          "æ–°å®¿è¡—é ­æ•£æ­¥ï¼Œå¯é †è·¯æ¡è²·ä¿æš–ç”¨å“æˆ–é›ªå…·å°ç‰©"
        ],
        tags: ["æŠµé”æ—¥", "è¼•é¬†è¡Œç¨‹", "åŸå¸‚å¤œæ™¯"],
        spots: [
          {
            name: "æ±äº¬ç«™",
            lat: 35.681236,
            lng: 139.767125,
            type: "tokyo"
          },
          {
            name: "æ–°å®¿ç«™",
            lat: 35.690921,
            lng: 139.700257,
            type: "tokyo"
          }
        ],
        budget: {
          min: 9000,
          max: 14000,
          note: "æ©Ÿå ´äº¤é€š + æ™šé¤ + Suica / Pasmo äº¤é€šå„²å€¼ï¼ˆä¸å«åœ‹éš›æ©Ÿç¥¨ï¼‰"
        }
      },
      {
        id: 2,
        date: "2026-01-11",
        label: "Day 2 Â· 1/11ï¼ˆæ—¥ï¼‰",
        region: "è¶Šå¾Œæ¹¯æ¾¤",
        title: "æ±äº¬ â‡’ è¶Šå¾Œæ¹¯æ¾¤ Â· æº«æ³‰è¡—æ•£æ­¥ & Ponshukan",
        description:
          "æ—©ä¸Šå¾æ±äº¬ç«™æ­ä¸Šè¶Šæ–°å¹¹ç·šå‰å¾€è¶Šå¾Œæ¹¯æ¾¤ï¼Œå…ˆå…¥ä½æˆ–å¯„æ”¾è¡Œæï¼Œæ…¢æ…¢é€›æº«æ³‰è¡—èˆ‡ç«™å…§ Ponshukanï¼Œå®‰æ’æ¸…é…’è©¦é£²èˆ‡è¶³æ¹¯ï¼Œç•¶ä½œé€²å…¥æ–°æ½Ÿé›ªåœ‹çš„æš–èº«æ—¥ã€‚",
        bullets: [
          "ä¸Šåˆï¼šæ±äº¬ç«™ â‡’ è¶Šå¾Œæ¹¯æ¾¤ç«™ï¼ˆä¸Šè¶Šæ–°å¹¹ç·šï¼Œç´„70ã€œ90åˆ†é˜ï¼‰",
          "ä¸­åˆï¼šç«™å…§æˆ–æº«æ³‰è¡—äº«ç”¨ hegi è•éº¥éºµç­‰åœ¨åœ°æ–™ç†",
          "åˆå¾Œï¼šPonshukan æ¸…é…’è©¦é£²ã€æº«æ³‰è¡—è¶³æ¹¯èˆ‡å°åº—æ•£æ­¥ï¼Œæ™šä¸Šå›æ—…é¤¨æ³¡æ¹¯"
        ],
        tags: ["ç§»å‹•æ—¥", "æ–°æ½Ÿç¸£", "æ¸…é…’é«”é©—", "æº«æ³‰"],
        spots: [
          {
            name: "æ±äº¬ç«™",
            lat: 35.681236,
            lng: 139.767125,
            type: "tokyo"
          },
          {
            name: "è¶Šå¾Œæ¹¯æ¾¤ç«™",
            lat: 36.9361,
            lng: 138.8099,
            type: "niigata"
          },
          {
            name: "è¶Šå¾Œæ¹¯æ¾¤ Ponshukan",
            lat: 36.9364,
            lng: 138.8096,
            type: "niigata"
          }
        ],
        budget: {
          min: 14000,
          max: 20000,
          note: "æ±äº¬â‡”è¶Šå¾Œæ¹¯æ¾¤æ–°å¹¹ç·šå–®ç¨‹ + é¤è²» + å°‘é‡æ¸…é…’è©¦é£²èˆ‡ä¼´æ‰‹ç¦®"
        }
      },
      {
        id: 3,
        date: "2026-01-12",
        label: "Day 3 Â· 1/12ï¼ˆä¸€ï¼‰",
        region: "è¶Šå¾Œæ¹¯æ¾¤",
        title: "GALA æ¹¯æ¾¤æ»‘é›ªï¼ˆç¬¬1æ—¥ï¼‰",
        description:
          "ç¬¬ä¸€å¤©æ­£å¼ä¸Šé›ªé“ï¼å¾è¶Šå¾Œæ¹¯æ¾¤ç«™æ­æ¥é§è‡³ GALA æ¹¯æ¾¤é›ªå ´ï¼Œå»ºè­°é¸æ“‡ä¸€æ—¥å¥—ç¥¨ï¼ˆçºœè»Šï¼‹é›ªå…·ç§Ÿå€Ÿï¼‹åˆå­¸èª²ç¨‹ï¼‰ï¼Œæ™šä¸Šå›æº«æ³‰æ—…é¤¨å¥½å¥½æ”¾é¬†è…¿éƒ¨è‚Œè‚‰ã€‚",
        bullets: [
          "ä¸Šåˆï¼šå¾è¶Šå¾Œæ¹¯æ¾¤ç«™æ­æ¥é§æˆ–æ–°å¹¹ç·šç›´é” GALA æ¹¯æ¾¤ç«™",
          "åœ¨ç§Ÿå€Ÿå€é ˜å–é›ªæ¿ï¼é›ªé‹èˆ‡è¡£ç‰©ï¼ŒåƒåŠ åˆå­¸èª²ç¨‹æˆ–è‡ªè¡Œç·´ç¿’",
          "å‚æ™šï¼šè¿”å›è¶Šå¾Œæ¹¯æ¾¤æº«æ³‰æ—…é¤¨ï¼Œæ™šé¤å»ºè­°é¸æº«æ³‰æ—…é¤¨æœƒå¸­æ–™ç†"
        ],
        tags: ["æ»‘é›ª", "é›ªåœ‹é«”é©—", "æº«æ³‰æ—…é¤¨"],
        spots: [
          {
            name: "è¶Šå¾Œæ¹¯æ¾¤ç«™",
            lat: 36.9361,
            lng: 138.8099,
            type: "niigata"
          },
          {
            name: "GALA æ¹¯æ¾¤æ»‘é›ªå ´",
            lat: 36.950483,
            lng: 138.799478,
            type: "niigata"
          }
        ],
        budget: {
          min: 18000,
          max: 26000,
          note: "GALA ä¸€æ—¥åˆ¸ï¼‹ç§Ÿè£å‚™ + é¤é£Ÿ + æº«æ³‰æ—…é¤¨ä½å®¿"
        }
      },
      {
        id: 4,
        date: "2026-01-13",
        label: "Day 4 Â· 1/13ï¼ˆäºŒï¼‰",
        region: "è¶Šå¾Œæ¹¯æ¾¤",
        title: "Kagura / Naeba é«˜é›ªè³ªæ»‘é›ªï¼ˆç¬¬2æ—¥ï¼‰",
        description:
          "ç¬¬äºŒå¤©å‰å¾€é›ªè³ªä½³ã€é›ªå­£é•·çš„ Kagura æˆ– Naeba æ»‘é›ªå ´ï¼Œé©åˆå·²ç¨å¾®ä¸Šæ‰‹è€…æŒ‘æˆ°æ›´é•·é›ªé“ï¼›ä¹Ÿå¯ä»¥é¸æ“‡è¼ƒå¹³ç·©è·¯ç·šæ‚ é–’æ»‘è¡Œã€‚",
        bullets: [
          "ä¹˜æ¥é§å·´å£«å‰å¾€ Kagura / Naeba æ»‘é›ªå ´",
          "é«”é©—é•·è·é›¢é›ªé“èˆ‡ç²’é›ªç²‰é›ªï¼Œé©åˆé€²éšåˆå­¸ï½ä¸­ç´šè€…",
          "å¤œæ™šè¿”å›è¶Šå¾Œæ¹¯æ¾¤æº«æ³‰è¡—ï¼Œå“åšç•¶åœ°æ‹‰éºµæˆ–æ—¥å¼å±…é…’å±‹"
        ],
        tags: ["æ»‘é›ª", "é›ªåœ‹é«”é©—", "å·´å£«ç§»å‹•"],
        spots: [
          {
            name: "è¶Šå¾Œæ¹¯æ¾¤ç«™ / æº«æ³‰è¡—",
            lat: 36.9361,
            lng: 138.8099,
            type: "niigata"
          },
          {
            name: "Kagura æ»‘é›ªå ´",
            lat: 36.835,
            lng: 138.802,
            type: "niigata"
          }
        ],
        budget: {
          min: 17000,
          max: 25000,
          note: "æ»‘é›ªä¸€æ—¥åˆ¸ï¼‹ç§Ÿè£å‚™ + æ¥é§å·´å£« + ä¸‰é¤"
        }
      },
      {
        id: 5,
        date: "2026-01-14",
        label: "Day 5 Â· 1/14ï¼ˆä¸‰ï¼‰",
        region: "è¶Šå¾Œæ¹¯æ¾¤",
        title: "è¶Šå¾Œæ¹¯æ¾¤æº«æ³‰è¡— Â· é›ªè¦‹æº«æ³‰ & å°é®æ…¢éŠ",
        description:
          "çµæŸå…©å¤©é«˜å¼·åº¦æ»‘é›ªå¾Œï¼Œä»¥æ‚ é–’æ­¥èª¿äº«å—é›ªè¦‹æº«æ³‰èˆ‡å°é®æ°›åœã€‚å¯å®‰æ’è¶³æ¹¯ã€å’–å•¡åº—ã€é›ªåœ°æ•£æ­¥èˆ‡å†è¨ªå–œæ­¡çš„é¤å»³ã€‚",
        bullets: [
          "ä¸Šåˆï¼šç¡åˆ°è‡ªç„¶é†’ï¼Œæº«æ³‰è¡—å’–å•¡åº—æˆ–éºµåŒ…åº—ç°¡å–®æ—©é¤",
          "ä¸­åˆï¼šåœ¨åœ° hegi è•éº¥éºµã€è±¬æ’ä¸¼ç­‰åç‰©å†è¨ªæˆ–å˜—è©¦æ–°åº—",
          "åˆå¾Œï¼šé›ªåœ‹é¤¨ã€è¶³æ¹¯ã€è¡—é“æ•£æ­¥èˆ‡å°åº—æ¡è³¼ï¼Œæ™šä¸Šå†æ³¡ä¸€æ¬¡æº«æ³‰"
        ],
        tags: ["æº«æ³‰å°é®", "ä½å¼·åº¦è¡Œç¨‹", "ç™‚ç™’æ—¥"],
        spots: [
          {
            name: "è¶Šå¾Œæ¹¯æ¾¤æº«æ³‰è¡—",
            lat: 36.9361,
            lng: 138.8099,
            type: "niigata"
          }
        ],
        budget: {
          min: 9000,
          max: 15000,
          note: "åœ¨åœ°é¤å»³ + å’–å•¡åº— / ç”œé»ï¼Œç„¡é•·è·é›¢äº¤é€š"
        }
      },
      {
        id: 6,
        date: "2026-01-15",
        label: "Day 6 Â· 1/15ï¼ˆå››ï¼‰",
        region: "åæ—¥ç”º Â· æ¸…æ´¥å³½",
        title: "åæ—¥ç”º Â· æ¸…æ´¥å³½ Tunnel of Light Â· é›ªåœ‹è—è¡“",
        description:
          "æ­ä¹˜åœ°æ–¹åˆ—è»Šæˆ–å·´å£«å‰å¾€åæ—¥ç”ºï¼æ¸…æ´¥å³½ï¼Œé€ è¨ªçµåˆå¤§åœ°è—è¡“ç¥­çš„ã€Tunnel of Lightã€ï¼Œå†¬å­£é›ªæ™¯æ˜ ç…§å³½è°·æ¥µå…·å¼µåŠ›ã€‚äº¦å¯å®‰æ’ Echigo-Tsumari Art Field çš„å®¤å…§ä½œå“ã€‚",
        bullets: [
          "ä¸Šåˆï¼šè¶Šå¾Œæ¹¯æ¾¤ â‡’ åæ—¥ç”ºï¼ˆJR æˆ–å·´å£«ï¼‰",
          "æ¸…æ´¥å³½ Â· Tunnel of Light è—è¡“åŒ–éš§é“ï¼Œæ¬£è³é›ªæ™¯èˆ‡å…‰å½±",
          "è¦–é«”åŠ›åƒè§€å…¶ä»– Echigo-Tsumari å®¤å…§ä½œå“ï¼Œå‚æ™šè¿”å›è¶Šå¾Œæ¹¯æ¾¤"
        ],
        tags: ["è‡ªç„¶æ™¯è§€", "è—è¡“ç¥­", "ä¸€æ—¥å°æ—…è¡Œ"],
        spots: [
          {
            name: "æ¸…æ´¥å³½ Tunnel of Light",
            lat: 37.0656,
            lng: 138.6711,
            type: "niigata"
          }
        ],
        budget: {
          min: 10000,
          max: 16000,
          note: "å€é–“è»Š / å·´å£«äº¤é€š + æ¸…æ´¥å³½é–€ç¥¨ + é¤è²»"
        }
      },
      {
        id: 7,
        date: "2026-01-16",
        label: "Day 7 Â· 1/16ï¼ˆäº”ï¼‰",
        region: "æ–°æ½Ÿå¸‚",
        title: "è¶Šå¾Œæ¹¯æ¾¤ â‡’ æ–°æ½Ÿå¸‚ Â· æ—¥æœ¬æµ·æµ·æ™¯èˆ‡å¤ç”ºæ•£ç­–",
        description:
          "ç”±è¶Šå¾Œæ¹¯æ¾¤æ­ä¸Šè¶Šæ–°å¹¹ç·šå‰å¾€æ–°æ½Ÿå¸‚å€ï¼Œå…¥ä½è»Šç«™é™„è¿‘é£¯åº—ã€‚ä¸‹åˆå‰å¾€è¬ä»£æ©‹ã€ä¿¡æ¿ƒå·æ²³ç•”èˆ‡å¤ç”ºèŠ±è¡—æ•£æ­¥ï¼Œæ„Ÿå—ã€æ°´ä¹‹éƒ½ã€æ°›åœã€‚",
        bullets: [
          "ä¸Šåˆï¼šè¶Šå¾Œæ¹¯æ¾¤ â‡’ æ–°æ½Ÿç«™ï¼ˆä¸Šè¶Šæ–°å¹¹ç·šï¼Œç´„50â€“60 åˆ†é˜ï¼‰",
          "åˆå¾Œï¼šè¬ä»£æ©‹ã€ä¿¡æ¿ƒå·æ²³å²¸æ•£æ­¥ï¼Œé †è¨ªå¤ç”ºå•†åº—è¡—",
          "æ™šé¤ï¼šæ–°æ½Ÿåœ¨åœ°å±…é…’å±‹ï¼Œå“åšæ—¥æœ¬æµ·æµ·é®®èˆ‡åœ°é…’"
        ],
        tags: ["ç§»å‹•æ—¥", "åŸå¸‚æ•£æ­¥", "æ—¥æœ¬æµ·æµ·æ™¯"],
        spots: [
          {
            name: "è¶Šå¾Œæ¹¯æ¾¤ç«™",
            lat: 36.9361,
            lng: 138.8099,
            type: "niigata"
          },
          {
            name: "æ–°æ½Ÿç«™",
            lat: 37.912051855,
            lng: 139.061245322,
            type: "niigata"
          },
          {
            name: "è¬ä»£æ©‹",
            lat: 37.9187,
            lng: 139.0544,
            type: "niigata"
          }
        ],
        budget: {
          min: 11000,
          max: 17000,
          note: "æ–°å¹¹ç·šå–®ç¨‹ + å¸‚å€äº¤é€š + æµ·é®®æ™šé¤"
        }
      },
      {
        id: 8,
        date: "2026-01-17",
        label: "Day 8 Â· 1/17ï¼ˆå…­ï¼‰",
        region: "æ–°æ½Ÿå¸‚",
        title: "Pier Bandai æµ·é®®å¸‚å ´ Â· æ–°æ½Ÿæ¸…é…’ & ç±³é£Ÿæ–‡åŒ–",
        description:
          "åœ¨æ–°æ½Ÿçš„å®Œæ•´ä¸€å¤©ï¼Œä¸»æ‰“ç•¶åœ°æµ·é®®èˆ‡æ¸…é…’ã€‚ä¸Šåˆå‰å¾€ Pier Bandai å¸‚å ´äº«ç”¨æµ·é®®ä¸¼èˆ‡ç”Ÿè ”ï¼Œä¸‹åˆå¯é€ è¨ªæ¸…é…’ç›¸é—œè¨­æ–½æˆ–æ°´æ—é¤¨ã€‚æ™šä¸Šæ‚ é–’æ‰“åŒ…è¡Œæã€‚",
        bullets: [
          "ä¸Šåˆï¼šPier Bandai Â· æµ·é®®å¸‚å ´æ—©é¤ï¼æ—©åˆé¤ï¼Œæ¡è²·ä¼´æ‰‹ç¦®",
          "åˆå¾Œï¼šæ–°æ½Ÿå¸‚æ°´æ—é¤¨ MARINEPIA Nihonkai æˆ–æ¸…é…’ç›¸é—œè¨­æ–½",
          "æ™šä¸Šï¼šå†è¨ªå–œæ­¡çš„å±…é…’å±‹æˆ–æº«æ³‰è¨­æ–½ï¼Œæº–å‚™éš”æ—¥è¿”ç¨‹"
        ],
        tags: ["æµ·é®®å¸‚å ´", "æ¸…é…’æ–‡åŒ–", "æ”¾é¬†æ—¥"],
        spots: [
          {
            name: "Pier Bandai",
            lat: 37.9178,
            lng: 139.0543,
            type: "niigata"
          }
        ],
        budget: {
          min: 10000,
          max: 17000,
          note: "æµ·é®®ä¸¼ + ä¼´æ‰‹ç¦® + æ¸…é…’å“é£²ï¼Œå¸‚å€äº¤é€š"
        }
      },
      {
        id: 9,
        date: "2026-01-18",
        label: "Day 9 Â· 1/18ï¼ˆæ—¥ï¼‰",
        region: "æ–°æ½Ÿ â‡’ æ±äº¬",
        title: "æ–°æ½Ÿ â‡’ æ±äº¬ â‡’ æ©Ÿå ´ Â· å›ç¨‹",
        description:
          "æ—©ä¸Šå¾æ–°æ½Ÿç«™æ­ä¸Šè¶Šæ–°å¹¹ç·šè¿”å›æ±äº¬ï¼Œæ–¼æ±äº¬ç«™é™„è¿‘ç°¡å–®ç”¨é¤èˆ‡æœ€å¾Œè³¼ç‰©ï¼Œå†ä¾èµ·é£›æ™‚é–“å‰å¾€æˆç”°ï¼ç¾½ç”°æ©Ÿå ´ï¼Œé ç•™è¶³å¤ æ›è»Šèˆ‡å®‰æª¢æ™‚é–“ã€‚",
        bullets: [
          "æ–°æ½Ÿç«™ â‡’ æ±äº¬ç«™ï¼ˆä¸Šè¶Šæ–°å¹¹ç·šï¼‰",
          "æ±äº¬ç«™ä¸€ç•ªè¡— & Gransta æœ€å¾Œæ¡è²·",
          "ä¾ 16:55 èµ·é£›æ™‚é–“å€’æ¨ 3â€“4 å°æ™‚ï¼Œæå‰æŠµé”æ©Ÿå ´è¾¦ç†ç™»æ©Ÿ"
        ],
        tags: ["è¿”ç¨‹æ—¥", "æœ€å¾Œæ¡è²·", "æ–°å¹¹ç·šç§»å‹•"],
        spots: [
          {
            name: "æ–°æ½Ÿç«™",
            lat: 37.912051855,
            lng: 139.061245322,
            type: "niigata"
          },
          {
            name: "æ±äº¬ç«™",
            lat: 35.681236,
            lng: 139.767125,
            type: "tokyo"
          }
        ],
        budget: {
          min: 11000,
          max: 17000,
          note: "æ–°å¹¹ç·šå–®ç¨‹ + æ©Ÿå ´äº¤é€š + é¤è²»ï¼ˆä¸å«å…ç¨…åº—è³¼ç‰©ï¼‰"
        }
      }
    ];

    // é¤å»³æ¨è–¦ï¼ˆç”¨ Google Maps æœå°‹ç¶²å€ï¼Œå¯¦éš›ç‡Ÿæ¥­æ™‚é–“äº¤çµ¦ Google é¡¯ç¤ºï¼‰
    const restaurants = [
      {
        area: "è¶Šå¾Œæ¹¯æ¾¤æº«æ³‰è¡—",
        name: "äººåƒäº­ Ninjin-tei",
        desc: "äººæ°£è±¬æ’ä¸¼ Â· å†¬å­£å¸¸å¤§æ’é•·é¾ï¼Œå»ºè­°é¿é–‹å°–å³°æˆ–æå‰æŠµé”ã€‚",
        tags: "è±¬æ’ä¸¼ / åœ¨åœ°ååº—",
        url: "https://www.google.com/maps/search/%E8%B6%8A%E5%BE%8C%E6%B9%AF%E6%BE%A4+%E4%BA%BA%E5%8F%83%E4%BA%AD"
      },
      {
        area: "è¶Šå¾Œæ¹¯æ¾¤ç«™å…§ Ponshukan",
        name: "ã½ã‚“ã—ã‚…é¤¨ è¶Šå¾Œæ¹¯æ¾¤é©›åº—",
        desc: "é›†çµæ–°æ½Ÿå¤šå®¶æ¸…é…’é…’è—èˆ‡ä¼´æ‰‹ç¦®ï¼Œç«™å…§å°±èƒ½å®Œæˆæ¸…é…’è©¦é£²èˆ‡è³¼ç‰©ã€‚",
        tags: "æ¸…é…’è©¦é£² / ä¼´æ‰‹ç¦®",
        url: "https://www.google.com/maps/search/%E3%81%BD%E3%82%93%E3%81%97%E3%82%85%E9%A4%A8+%E8%B6%8A%E5%BE%8C%E6%B9%AF%E6%BE%A4"
      },
      {
        area: "è¶Šå¾Œæ¹¯æ¾¤æº«æ³‰è¡—",
        name: "è¶Šå¾Œæ¹¯æ¾¤ Hegi è•éº¥éºµï¼ˆä¾‹å¦‚ï¼šã—ã‚“ã°ã—ï¼‰",
        desc: "ä½¿ç”¨å¸ƒæµ·è‹”è£½ä½œçš„ hegi è•éº¥éºµï¼Œæ˜¯é­šæ²¼ã€æ–°æ½Ÿçš„ä»£è¡¨éºµé£Ÿã€‚",
        tags: "è•éº¥éºµ / åœ¨åœ°æ–™ç†",
        url: "https://www.google.com/maps/search/%E8%B6%8A%E5%BE%8C%E6%B9%AF%E6%BE%A4+%E3%81%97%E3%82%93%E3%81%B0%E3%81%97+%E8%95%8E%E9%BA%A6"
      },
      {
        area: "æ±äº¬ Â· æ·ºè‰",
        name: "æ·ºè‰ä»ŠåŠ åœ‹éš›é€šæœ¬åº—",
        desc: "è€ç‰Œå£½å–œç‡’ååº—ï¼Œé©åˆæ±äº¬æ®µå®‰æ’ä¸€æ™šè¼ƒæ­£å¼çš„å’Œç‰›æ™šé¤ã€‚",
        tags: "å£½å–œç‡’ / å’Œç‰›",
        url: "https://www.google.com/maps/search/%E6%B7%BA%E8%8D%89%E4%BB%8A%E5%8D%8A"
      },
      {
        area: "æ–°æ½Ÿå¸‚å€ Â· Pier Bandai",
        name: "Pier Bandai æµ·é®®ä¸¼åº—ï¼ˆä¾‹ï¼šå»»è½‰å£½å¸ãƒ»å¼æ…¶ï¼‰",
        desc: "é›†åˆå¤šå®¶æµ·é®®ä¸¼èˆ‡è¿´è½‰å£½å¸åº—ï¼Œæ—©åˆé¤å°±èƒ½åƒåˆ°æ—¥æœ¬æµ·æ–°é®®æ¼ç²ã€‚",
        tags: "æµ·é®®ä¸¼ / è¿´è½‰å£½å¸",
        url: "https://www.google.com/maps/search/Pier+Bandai+%E5%BC%81%E6%85%B6"
      },
      {
        area: "æ–°æ½Ÿç«™å‘¨é‚Š",
        name: "ã½ã‚“ã—ã‚…é¤¨ æ–°æ½Ÿé©›åº—ï¼ˆKaku-uchi é…’å§ï¼‰",
        desc: "é›¢æ–°æ½Ÿç«™æ¥µè¿‘ï¼Œå¯é‚Šç­‰è»Šé‚Šå“åšä¸åŒé…’è—çš„æ¸…é…’èˆ‡è¼•é£Ÿã€‚",
        tags: "ç«‹é£²é…’å§ / æ¸…é…’",
        url: "https://www.google.com/maps/search/%E3%81%BD%E3%82%93%E3%81%97%E3%82%85%E9%A4%A8+%E6%96%B0%E6%BD%9F%E9%A7%85"
      }
    ];

    let itinerary = JSON.parse(JSON.stringify(initialItinerary));

    // === DOM å…ƒç´  ===
    const itineraryListEl = document.getElementById("itineraryList");
    const totalRangeEl = document.getElementById("totalRange");
    const dailyRangeEl = document.getElementById("dailyRange");
    const restaurantListEl = document.getElementById("restaurantList");
    const resetOrderBtn = document.getElementById("resetOrderBtn");

    // === Leaflet åœ°åœ–è¨­å®š ===
    const map = L.map("map", {
      zoomControl: false
    }).setView([36.7, 138.9], 6);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 19,
      attribution: "&copy; OpenStreetMap"
    }).addTo(map);

    L.control
      .zoom({
        position: "bottomright"
      })
      .addTo(map);

    let markerGroup = L.layerGroup().addTo(map);
    let routeLine = null;

    function iconForType(type) {
      const color = type === "tokyo" ? "#f28f6b" : "#5b8ad6";
      return L.divIcon({
        className: "custom-marker",
        html:
          '<div style="width:14px;height:14px;border-radius:999px;background:' +
          color +
          ';box-shadow:0 0 0 3px rgba(255,255,255,0.85);border:1px solid rgba(0,0,0,0.15);"></div>',
        iconSize: [14, 14],
        iconAnchor: [7, 7]
      });
    }

    function updateMap(highlightDayId = null) {
      markerGroup.clearLayers();
      if (routeLine) {
        map.removeLayer(routeLine);
        routeLine = null;
      }

      const coords = [];

      itinerary.forEach((day) => {
        (day.spots || []).forEach((spot) => {
          const marker = L.marker([spot.lat, spot.lng], {
            icon: iconForType(spot.type)
          }).addTo(markerGroup);

          const isHighlight = highlightDayId && day.id === highlightDayId;

          marker.bindPopup(
            `<strong>${spot.name}</strong><br/><span style="font-size:11px;">${day.label} Â· ${day.title}</span>`
          );

          if (isHighlight) {
            marker.openPopup();
          }

          coords.push([spot.lat, spot.lng]);
        });
      });

      if (coords.length) {
        routeLine = L.polyline(coords, {
          color: "#c9a36b",
          weight: 3,
          opacity: 0.75
        }).addTo(map);
        map.fitBounds(routeLine.getBounds(), {
          padding: [20, 20]
        });
      }
    }

    // === è¡Œç¨‹æ¸²æŸ“ ===
    function renderItinerary() {
      itineraryListEl.innerHTML = "";
      itinerary.forEach((day) => {
        const card = document.createElement("article");
        card.className = "day-card";
        card.setAttribute("draggable", "true");
        card.dataset.id = day.id;

        card.innerHTML = `
          <div class="day-header">
            <div>
              <div class="day-label">${day.label}</div>
              <div class="day-main-title">${day.title}</div>
            </div>
            <div class="day-region-pill">
              <span style="width:7px;height:7px;border-radius:999px;background:${
                day.region.includes("æ±äº¬") ? "#f28f6b" : "#5b8ad6"
              };display:inline-block;"></span>
              ${day.region}
            </div>
          </div>
          <div class="day-body">
            <p>${day.description}</p>
            <ul>
              ${day.bullets.map((b) => `<li>${b}</li>`).join("")}
            </ul>
            <div class="day-tags">
              ${day.tags.map((t) => `<span class="day-tag"># ${t}</span>`).join("")}
            </div>
            <div class="day-budget">
              ä¼°è¨ˆèŠ±è²»ï¼š<strong>${day.budget.min.toLocaleString()}ã€œ${day.budget.max.toLocaleString()} JPY</strong><br/>
              <span>${day.budget.note}</span>
            </div>
          </div>
        `;

        // é»é¸å¡ç‰‡æ™‚ï¼Œåœ°åœ–èšç„¦
        card.addEventListener("click", () => {
          updateMap(day.id);
        });

        // Drag & Drop
        card.addEventListener("dragstart", (e) => {
          card.classList.add("dragging");
          e.dataTransfer.effectAllowed = "move";
          e.dataTransfer.setData("text/plain", day.id.toString());
        });

        card.addEventListener("dragend", () => {
          card.classList.remove("dragging");
          document
            .querySelectorAll(".day-card.drag-over")
            .forEach((el) => el.classList.remove("drag-over"));
        });

        card.addEventListener("dragover", (e) => {
          e.preventDefault();
          const dragging = document.querySelector(".day-card.dragging");
          if (!dragging || dragging === card) return;
          card.classList.add("drag-over");
        });

        card.addEventListener("dragleave", () => {
          card.classList.remove("drag-over");
        });

        card.addEventListener("drop", (e) => {
          e.preventDefault();
          card.classList.remove("drag-over");
          const draggedId = parseInt(e.dataTransfer.getData("text/plain"), 10);
          const targetId = day.id;
          if (draggedId === targetId) return;

          const draggedIndex = itinerary.findIndex((d) => d.id === draggedId);
          const targetIndex = itinerary.findIndex((d) => d.id === targetId);
          const [draggedItem] = itinerary.splice(draggedIndex, 1);
          itinerary.splice(targetIndex, 0, draggedItem);

          renderItinerary();
          updateBudgetSummary();
          updateMap();
        });

        itineraryListEl.appendChild(card);
      });
    }

    // === é ç®—è¨ˆç®— ===
    function updateBudgetSummary() {
      const totals = itinerary.reduce(
        (acc, day) => {
          acc.min += day.budget.min;
          acc.max += day.budget.max;
          return acc;
        },
        { min: 0, max: 0 }
      );

      const days = itinerary.length || 1;
      const minPerDay = Math.round(totals.min / days);
      const maxPerDay = Math.round(totals.max / days);

      totalRangeEl.textContent =
        totals.min.toLocaleString() + "ã€œ" + totals.max.toLocaleString();
      dailyRangeEl.textContent =
        minPerDay.toLocaleString() + "ã€œ" + maxPerDay.toLocaleString() + " / æ—¥";
    }

    // === é¤å»³æ¸²æŸ“ ===
    function renderRestaurants() {
      restaurantListEl.innerHTML = "";
      restaurants.forEach((r) => {
        const item = document.createElement("div");
        item.className = "restaurant-item";
        item.innerHTML = `
          <div class="restaurant-info">
            <div class="restaurant-name">${r.name}</div>
            <div class="restaurant-tags">${r.area} Â· ${r.tags}</div>
            <div class="open-status" data-open-status>
              é»æ“Šå³å´æŒ‰éˆ•å¾Œï¼Œå¯åœ¨ Google åœ°åœ–æŸ¥çœ‹å³æ™‚ç‡Ÿæ¥­æ™‚é–“
            </div>
          </div>
          <div class="restaurant-action">
            <a href="${r.url}" target="_blank" rel="noopener noreferrer">
              æŸ¥çœ‹åœ°åœ– / è¨‚ä½
            </a>
          </div>
        `;
        restaurantListEl.appendChild(item);
      });
    }

    // === åˆå§‹åŒ– ===
    renderItinerary();
    updateBudgetSummary();
    renderRestaurants();
    updateMap();

    // é‡ç½®æ’åºæŒ‰éˆ•
    resetOrderBtn.addEventListener("click", () => {
      itinerary = JSON.parse(JSON.stringify(initialItinerary));
      renderItinerary();
      updateBudgetSummary();
      updateMap();
    });
  </script>

  <!-- ğŸ”„ è‡ªå‹•ç‰ˆæœ¬ç·¨è™Ÿï¼ˆcache-busterï¼‰ï¼šé‡å° data-versioned="true" çš„ <link> / <script> åŠ ä¸Š ?v=timestamp -->
  <script>
    (function () {
      const version = new Date().getTime();

      window.addEventListener('load', function () {
        document
          .querySelectorAll('link[rel="stylesheet"][data-versioned="true"]')
          .forEach(function (link) {
            try {
              const url = new URL(link.href);
              url.searchParams.set('v', version);
              link.href = url.toString();
            } catch (e) {
              // å¿½ç•¥ç„¡æ³•è§£æçš„ URL
            }
          });

        document
          .querySelectorAll('script[src][data-versioned="true"]')
          .forEach(function (script) {
            try {
              const url = new URL(script.src);
              url.searchParams.set('v', version);
              script.src = url.toString();
            } catch (e) {
              // å¿½ç•¥ç„¡æ³•è§£æçš„ URL
            }
          });
      });
    })();
  </script>
</body>
</html>
